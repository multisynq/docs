## Controller

<a id="controller"></a>
### Constructor
<CodeGroup>
```typescript
constructor()
```
</CodeGroup>
<Tabs>
<Tab title="Methods">
#### Instance Methods
<AccordionGroup>
<Accordion title="reset">
<CodeGroup>
```typescript
reset(): any
```
</CodeGroup>
</Accordion>
<Accordion title="id">
<CodeGroup>
```typescript
id(): any
```
</CodeGroup>
</Accordion>
<Accordion title="persistentId">
<CodeGroup>
```typescript
persistentId(): any
```
</CodeGroup>
</Accordion>
<Accordion title="versionId">
<CodeGroup>
```typescript
versionId(): any
```
</CodeGroup>
</Accordion>
<Accordion title="extrapolatedTime">
<CodeGroup>
```typescript
extrapolatedTime(): any
```
</CodeGroup>
</Accordion>
<Accordion title="viewOnly">
<CodeGroup>
```typescript
viewOnly(): any
```
</CodeGroup>
</Accordion>
<Accordion title="backlog">
<CodeGroup>
```typescript
backlog(): any
```
</CodeGroup>
</Accordion>
<Accordion title="starvation">
<CodeGroup>
```typescript
starvation(): any
```
</CodeGroup>
</Accordion>
<Accordion title="lag">
<CodeGroup>
```typescript
lag(): any
```
</CodeGroup>
</Accordion>
<Accordion title="activity">
<CodeGroup>
```typescript
activity(): any
```
</CodeGroup>
</Accordion>
<Accordion title="viewed">
<CodeGroup>
```typescript
viewed(): any
```
</CodeGroup>
</Accordion>
<Accordion title="connected">
<CodeGroup>
```typescript
connected(): any
```
</CodeGroup>
</Accordion>
<Accordion title="shouldLeaveWhenDisconnected">
<CodeGroup>
```typescript
shouldLeaveWhenDisconnected(): any
```
</CodeGroup>
</Accordion>
<Accordion title="canRejoinSeamlessly">
<CodeGroup>
```typescript
canRejoinSeamlessly(): any
```
</CodeGroup>
</Accordion>
<Accordion title="migratingOldSnapshot">
<CodeGroup>
```typescript
migratingOldSnapshot(): any
```
</CodeGroup>
</Accordion>
<Accordion title="checkForConnection">
<CodeGroup>
```typescript
checkForConnection(force: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="force" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="dormantDisconnect">
<CodeGroup>
```typescript
dormantDisconnect(): any
```
</CodeGroup>
</Accordion>
<Accordion title="initFromSessionSpec">
<CodeGroup>
```typescript
async initFromSessionSpec(sessionSpec: any): any
```
</CodeGroup>
<p>Initialise the controller from the sessionSpec assembled in Session.join() - the vm/session id is created from <code>name</code> and a hash of registered options and source code</p>
##### Parameters
<ParamField path="sessionSpec" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="establishSession">
<CodeGroup>
```typescript
async establishSession(): any
```
</CodeGroup>
<p>Join or create a session by connecting to the reflector /</p>
</Accordion>
<Accordion title="getBackend">
<CodeGroup>
```typescript
getBackend(apiKeysWithBackend: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="apiKeysWithBackend" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="verifyApiKey">
<CodeGroup>
```typescript
async verifyApiKey(apiKeysWithBackend: any, appId: any, persistentId: any): any
```
</CodeGroup>
<p>fetch developerId from sign function via meta protocol */</p>
##### Parameters
<ParamField path="apiKeysWithBackend" type="any" required={true}>

</ParamField>
<ParamField path="appId" type="any" required={true}>

</ParamField>
<ParamField path="persistentId" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="fetchWithRetries">
<CodeGroup>
```typescript
async fetchWithRetries(goal: any, instantFailureCodes: any, allowedRetries: any, fetchFn: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="goal" type="any" required={true}>

</ParamField>
<ParamField path="instantFailureCodes" type="any" required={true}>

</ParamField>
<ParamField path="allowedRetries" type="any" required={true}>

</ParamField>
<ParamField path="fetchFn" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="lastKnownTime">
<CodeGroup>
```typescript
lastKnownTime(vmOrSnapshot: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="vmOrSnapshot" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="takeSnapshot">
<CodeGroup>
```typescript
takeSnapshot(): any
```
</CodeGroup>
</Accordion>
<Accordion title="takeSnapshotHandleErrors">
<CodeGroup>
```typescript
takeSnapshotHandleErrors(): any
```
</CodeGroup>
</Accordion>
<Accordion title="setDebug">
<CodeGroup>
```typescript
setDebug(options: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="options" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="requestDebugSnapshot">
<CodeGroup>
```typescript
requestDebugSnapshot(): any
```
</CodeGroup>
</Accordion>
<Accordion title="scheduleSnapshot">
<CodeGroup>
```typescript
scheduleSnapshot(force: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="force" type="any" required={true} default="false">

</ParamField>
</Accordion>
<Accordion title="handlePollForSnapshot">
<CodeGroup>
```typescript
handlePollForSnapshot(time: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="pollForSnapshot">
<CodeGroup>
```typescript
pollForSnapshot(time: any, voteData: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
<ParamField path="voteData" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="handleSnapshotVote">
<CodeGroup>
```typescript
handleSnapshotVote(data: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="data" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="analyzeTally">
<CodeGroup>
```typescript
analyzeTally(tally: any, timeProperty: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="tally" type="any" required={true}>

</ParamField>
<ParamField path="timeProperty" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="snapshotPath">
<CodeGroup>
```typescript
snapshotPath(time: any, seq: any, hash: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
<ParamField path="seq" type="any" required={true}>

</ParamField>
<ParamField path="hash" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="hashSnapshot">
<CodeGroup>
```typescript
hashSnapshot(snapshot: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="snapshot" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="uploadServer">
<CodeGroup>
```typescript
uploadServer(apiKeysWithBackend: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="apiKeysWithBackend" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="uploadSnapshot">
<CodeGroup>
```typescript
async uploadSnapshot(snapshot: any, auditStats: any, dissidentFlag: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="snapshot" type="any" required={true}>

</ParamField>
<ParamField path="auditStats" type="any" required={true}>

</ParamField>
<ParamField path="dissidentFlag" type="any" required={true} default="null">

</ParamField>
</Accordion>
<Accordion title="announceSnapshotUrl">
<CodeGroup>
```typescript
announceSnapshotUrl(time: any, seq: any, hash: any, url: any, auditStats: any, dissidentFlag: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
<ParamField path="seq" type="any" required={true}>

</ParamField>
<ParamField path="hash" type="any" required={true}>

</ParamField>
<ParamField path="url" type="any" required={true}>

</ParamField>
<ParamField path="auditStats" type="any" required={true}>

</ParamField>
<ParamField path="dissidentFlag" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="diffDivergedSnapshots">
<CodeGroup>
```typescript
async diffDivergedSnapshots(urls: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="urls" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="downloadEncrypted">
<CodeGroup>
```typescript
async downloadEncrypted({url, gzip, key, debug, json, what}: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="{url, gzip, key, debug, json, what}" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="fetchOffline">
<CodeGroup>
```typescript
async fetchOffline(url: any, what: any, debug: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="url" type="any" required={true}>

</ParamField>
<ParamField path="what" type="any" required={true}>

</ParamField>
<ParamField path="debug" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="uploadEncrypted">
<CodeGroup>
```typescript
async uploadEncrypted({content, path, key, gzip, keep, debug, what}: any): any
```
</CodeGroup>
<p>upload string or array buffer as binary encrypted, optionally gzipped if path contains %HASH% it will be replaced by the hash after encryption /</p>
##### Parameters
<ParamField path="{content, path, key, gzip, keep, debug, what}" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="persistentPath">
<CodeGroup>
```typescript
persistentPath(hash: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="hash" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="pollForPersist">
<CodeGroup>
```typescript
pollForPersist(vmTime: any, persistTime: any, persistentString: any, persistentHash: any, ms: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="vmTime" type="any" required={true}>

</ParamField>
<ParamField path="persistTime" type="any" required={true}>

</ParamField>
<ParamField path="persistentString" type="any" required={true}>

</ParamField>
<ParamField path="persistentHash" type="any" required={true}>

</ParamField>
<ParamField path="ms" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="handlePersistVote">
<CodeGroup>
```typescript
async handlePersistVote(data: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="data" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="doPersist">
<CodeGroup>
```typescript
async doPersist(persistTime: any, persistentString: any, persistentHash: any, dissidentFlag: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="persistTime" type="any" required={true}>

</ParamField>
<ParamField path="persistentString" type="any" required={true}>

</ParamField>
<ParamField path="persistentHash" type="any" required={true}>

</ParamField>
<ParamField path="dissidentFlag" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="forcePersist">
<CodeGroup>
```typescript
async forcePersist(persistTime: any, persistentString: any, persistentHash: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="persistTime" type="any" required={true}>

</ParamField>
<ParamField path="persistentString" type="any" required={true}>

</ParamField>
<ParamField path="persistentHash" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="convertReflectorMessage">
<CodeGroup>
```typescript
convertReflectorMessage(msg: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="handleTuttiResult">
<CodeGroup>
```typescript
handleTuttiResult(data: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="data" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="handleAuditRequest">
<CodeGroup>
```typescript
handleAuditRequest(data: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="data" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="handleUserTotalForAccounting">
<CodeGroup>
```typescript
handleUserTotalForAccounting(total: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="total" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="messageSizeForAccounting">
<CodeGroup>
```typescript
messageSizeForAccounting(msg: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="receive">
<CodeGroup>
```typescript
async receive(action: any, args: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="action" type="any" required={true}>

</ParamField>
<ParamField path="args" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="install">
<CodeGroup>
```typescript
install(persistentData: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="persistentData" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="setVM">
<CodeGroup>
```typescript
setVM(vm: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="vm" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="sendJoin">
<CodeGroup>
```typescript
sendJoin(): any
```
</CodeGroup>
</Accordion>
<Accordion title="clearSyncReceiptTimeout">
<CodeGroup>
```typescript
clearSyncReceiptTimeout(): any
```
</CodeGroup>
</Accordion>
<Accordion title="connectionInterrupted">
<CodeGroup>
```typescript
connectionInterrupted(): any
```
</CodeGroup>
</Accordion>
<Accordion title="leave">
<CodeGroup>
```typescript
leave(keepController: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="keepController" type="any" required={true} default="false">

</ParamField>
</Accordion>
<Accordion title="encrypt">
<CodeGroup>
```typescript
async encrypt(plaintext: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="plaintext" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="deprecatedDefaultKey">
<CodeGroup>
```typescript
deprecatedDefaultKey(): any
```
</CodeGroup>
</Accordion>
<Accordion title="decrypt">
<CodeGroup>
```typescript
decrypt(encrypted: any, key: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="encrypted" type="any" required={true}>

</ParamField>
<ParamField path="key" type="any" required={true} default="this.key">

</ParamField>
</Accordion>
<Accordion title="decryptBinary">
<CodeGroup>
```typescript
decryptBinary(buffer: any, key: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="buffer" type="any" required={true}>

</ParamField>
<ParamField path="key" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="encryptMessage">
<CodeGroup>
```typescript
async encryptMessage(msg: any, viewId: any, sendTime: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
<ParamField path="viewId" type="any" required={true}>

</ParamField>
<ParamField path="sendTime" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="encryptPayload">
<CodeGroup>
```typescript
async encryptPayload(payload: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="payload" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="decryptPayload">
<CodeGroup>
```typescript
decryptPayload(encrypted: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="encrypted" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="compareHmacs">
<CodeGroup>
```typescript
compareHmacs(fst: any, snd: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="fst" type="any" required={true}>

</ParamField>
<ParamField path="snd" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="sendMessage">
<CodeGroup>
```typescript
sendMessage(msg: any): any
```
</CodeGroup>
<p>send a Message to all vm replicas via reflector</p>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="recordRateLimitedSend">
<CodeGroup>
```typescript
recordRateLimitedSend(time: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="addToRateLimitBuffer">
<CodeGroup>
```typescript
addToRateLimitBuffer(msg: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="serviceRateLimitBuffer">
<CodeGroup>
```typescript
serviceRateLimitBuffer(): any
```
</CodeGroup>
</Accordion>
<Accordion title="socketSendMessage">
<CodeGroup>
```typescript
async socketSendMessage(msg: any, tags: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
<ParamField path="tags" type="any" required={true} default="null">

</ParamField>
</Accordion>
<Accordion title="sendTagged">
<CodeGroup>
```typescript
async sendTagged(msg: any, tags: any): any
```
</CodeGroup>
<p>send a Message to all vm replicas via reflector, subject to reflector preprocessing as determined by the tag(s)</p>
##### Parameters
<ParamField path="msg" type="any" required={true}>

</ParamField>
<ParamField path="tags" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="sendTutti">
<CodeGroup>
```typescript
async sendTutti({ time, topic, data, localContext=null, firstMessage=null, wantsVote=true, tallyTarget=null }: any): any
```
</CodeGroup>
<p>send a TUTTI Message</p>
##### Parameters
<ParamField path="{ time, topic, data, localContext=null, firstMessage=null, wantsVote=true, tallyTarget=null }" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="sendLog">
<CodeGroup>
```typescript
sendLog(args: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="args" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="addToStatistics">
<CodeGroup>
```typescript
addToStatistics(timeSent: any, timeReceived: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="timeSent" type="any" required={true}>

</ParamField>
<ParamField path="timeReceived" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="latencies">
<CodeGroup>
```typescript
latencies(): any
```
</CodeGroup>
</Accordion>
<Accordion title="getTickAndMultiplier">
<CodeGroup>
```typescript
getTickAndMultiplier(): any
```
</CodeGroup>
<p>parse tps <code>ticks x multiplier</code> ticks are from server, multiplied by locally generated ticks default taken from <code>sessionSpec.tps</code> unless <code>sessionSpec.options.tps</code> is present</p>
##### Returns
<ResponseField type="any">
<p>{{<pre><code>msPerTick: Number,  // effective tick period in ms multiplier: Number, // local multiplier tick: Number,       // reflector tick period in ms delay: Number,      // reflector delay to account for locally produced ticks</code></pre> }} /</p>
</ResponseField>
</Accordion>
<Accordion title="simulate">
<CodeGroup>
```typescript
simulate(deadline: any): any
```
</CodeGroup>
<p>Process pending messages for this vm and advance simulation</p>
##### Parameters
<ParamField path="deadline" type="any" required={true}>

</ParamField>
##### Returns
<ResponseField type="any">
<p>{Boolean} true if simulation finished before deadline /</p>
</ResponseField>
</Accordion>
<Accordion title="stepSession">
<CodeGroup>
```typescript
stepSession(stepType: any, parameters: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="stepType" type="any" required={true}>

</ParamField>
<ParamField path="parameters" type="any" required={true} default="{}">

</ParamField>
</Accordion>
<Accordion title="applySyncChange">
<CodeGroup>
```typescript
applySyncChange(bool: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="bool" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="inViewRealm">
<CodeGroup>
```typescript
inViewRealm(fn: any): any
```
</CodeGroup>
<p>execute something in the view realm */</p>
##### Parameters
<ParamField path="fn" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="processModelViewEvents">
<CodeGroup>
```typescript
processModelViewEvents(isInAnimationStep: any): any
```
</CodeGroup>
<p>call this from main loop to process queued model=>view events</p>
##### Parameters
<ParamField path="isInAnimationStep" type="any" required={true}>

</ParamField>
##### Returns
<ResponseField type="any">
<p>{Number} number of processed events /</p>
</ResponseField>
</Accordion>
<Accordion title="timeFromReflector">
<CodeGroup>
```typescript
timeFromReflector(time: any, src: any, rawTime: any): any
```
</CodeGroup>
<p>Got the official time from reflector (on SYNC, TICK or RECV), or local tick multiplier.  src is "reflector" or "controller".  rawTime is reflector performance.now() since the resumption of the session, currently (dec 2021) defined in experimental reflectors on RECV events only, if flag "rawtime" is requested on join(). */</p>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
<ParamField path="src" type="any" required={true}>

</ParamField>
<ParamField path="rawTime" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="multiplyTick">
<CodeGroup>
```typescript
multiplyTick(time: any): any
```
</CodeGroup>
<p>we received a tick from reflector, generate local ticks */</p>
##### Parameters
<ParamField path="time" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="startStepping">
<CodeGroup>
```typescript
startStepping(autoStepFn: any): any
```
</CodeGroup>
##### Parameters
<ParamField path="autoStepFn" type="any" required={true}>

</ParamField>
</Accordion>
<Accordion title="setUpActivityChecks">
<CodeGroup>
```typescript
setUpActivityChecks(): any
```
</CodeGroup>
</Accordion>
<Accordion title="toString">
<CodeGroup>
```typescript
toString(): any
```
</CodeGroup>
</Accordion>
<Accordion title="[Symbol.toPrimitive]">
<CodeGroup>
```typescript
[Symbol.toPrimitive](): any
```
</CodeGroup>
</Accordion>
</AccordionGroup>
</Tab>
</Tabs>